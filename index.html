<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora de Cer√¢mica</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h2>m2A. Or√ßamentos Inteligentes</h2>

    <label>Tipo de Piso:</label>
    <select id="tipoPiso">
      <option value="ceramica">Cer√¢mica</option>
      <option value="porcelanato">Porcelanato</option>
    </select>

    <label>ID do Produto / Nome do Cliente:</label>
    <input type="text" id="idProduto" placeholder="Ex: 12345 RAVY">

    <label>√Årea total (m¬≤):</label>
    <input type="number" id="areaTotal">

    <label>√Årea por caixa (m¬≤):</label>
    <input type="number" step="0.01" id="areaCaixa">

    <label>Valor do m¬≤ (R$):</label>
    <input type="number" step="0.01" id="valorMetro">

    <label>Margem de sobra (%):</label>
    <input type="number" id="margemSobra" value="10">

    <button onclick="calcularCeramica()">Calcular valor do piso</button>
    <div class="resultado" id="resultadoCeramica"></div>

    <hr style="margin: 24px 0;">

    <label>Pre√ßo por saco de argamassa (20kg):</label>
    <input type="number" step="0.01" id="argamassaOutro" placeholder="Ex: 21.90">

    <button onclick="calcularTotal()">Calcular Total com Argamassa e Rejunte</button>
    <div class="resultado" id="resultadoFinal"></div>

    <hr style="margin: 24px 0;">

    <label style="margin-top: 20px;">
      <input type="checkbox" id="toggleTema"> Ativar modo escuro
    </label>

    <button onclick="gerarPDF()">Gerar Or√ßamento em PDF</button>
    <button onclick="compararMarcas()">Comparar Marcas</button>
    <button onclick="limparTudo()">Limpar Tudo</button>

    <div class="resultado" id="resultadoComparativo"></div>

    <footer>
      Desenvolvido por <strong>m2A.Dev</strong> ¬∑ Vers√£o 2.3
    </footer>
  </div>

  <script src="script.js"></script>
</body>
</html>:root {
  --primary: #0078D7;
  --bg-light: #f0f2f5;
  --bg-dark: #1f1f1f;
  --container-light: #fff;
  --container-dark: #2a2a2a;
  --text-light: #111;
  --text-dark: #e0e0e0;
  --border-light: #ccc;
  --border-dark: #666;
  --highlight: #eef3fb;
  --highlight-dark: #3a3a3a;
}

body {
  font-family: 'Segoe UI', sans-serif;
  background-color: var(--bg-light);
  margin: 0;
  padding: 12px;
  color: var(--text-light);
  transition: background 0.3s ease, color 0.3s ease;
}

.container {
  max-width: 540px;
  margin: auto;
  background: var(--container-light);
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  padding: 20px;
}

h2 {
  text-align: center;
  color: var(--primary);
}

label {
  font-weight: bold;
  margin-top: 12px;
  display: block;
}

input[type="number"],
input[type="text"],
select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border: 1px solid var(--border-light);
  border-radius: 6px;
  font-size: 16px;
}

button {
  width: 100%;
  margin-top: 20px;
  padding: 14px;
  background-color: var(--primary);
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  cursor: pointer;
}

.resultado {
  margin-top: 24px;
  background: var(--highlight);
  padding: 16px;
  border-radius: 8px;
  font-size: 18px;
  line-height: 1.6;
}

footer {
  margin-top: 40px;
  text-align: center;
  font-size: 14px;
  color: #666;
}

/* üåô Modo escuro */
body.dark-mode {
  background-color: var(--bg-dark);
  color: var(--text-dark);
}

body.dark-mode .container {
  background-color: var(--container-dark);
}

body.dark-mode input,
body.dark-mode select {
  background-color: #444;
  color: #fff;
  border-color: var(--border-dark);
}

body.dark-mode .resultado {
  background-color: var(--highlight-dark);
}let areaComSobraGlobal = 0;
let areaAdquiridaGlobal = 0;

function calcularCeramica() {
  const area = parseFloat(document.getElementById("areaTotal").value);
  const areaCaixa = parseFloat(document.getElementById("areaCaixa").value);
  const valorMetro = parseFloat(document.getElementById("valorMetro").value);
  const sobra = parseFloat(document.getElementById("margemSobra").value) / 100;

  if (isNaN(area) || isNaN(areaCaixa) || isNaN(valorMetro)) {
    document.getElementById("resultadoCeramica").innerHTML = "Preencha os campos obrigat√≥rios.";
    return;
  }

  const areaComSobra = area * (1 + sobra);
  const caixas = Math.ceil(areaComSobra / areaCaixa);
  const areaRealAdquirida = caixas * areaCaixa;
  const valorPiso = areaRealAdquirida * valorMetro;

  areaComSobraGlobal = areaComSobra;
  areaAdquiridaGlobal = areaRealAdquirida;

  document.getElementById("resultadoCeramica").innerHTML = `
    <strong>√Årea com sobra:</strong> ${areaComSobra.toFixed(2)} m¬≤<br>
    <strong>Caixas necess√°rias:</strong> ${caixas}<br>
    <strong>√Årea real adquirida:</strong> ${areaRealAdquirida.toFixed(2)} m¬≤<br>
    <strong>Valor da cer√¢mica:</strong> R$ ${valorPiso.toFixed(2)}
  `;
  salvarDados();
}

function calcularTotal() {
  const tipo = document.getElementById("tipoPiso")?.value || "ceramica";
  const valorMetro = parseFloat(document.getElementById("valorMetro").value);
  const precoArgamassa = parseFloat(document.getElementById("argamassaOutro").value) || 0;

  if (!areaAdquiridaGlobal || isNaN(valorMetro) || isNaN(precoArgamassa)) {
    document.getElementById("resultadoFinal").innerHTML = "Preencha os campos corretamente e calcule primeiro a cer√¢mica.";
    return;
  }

  const valorPiso = areaAdquiridaGlobal * valorMetro;
  const sacosArgamassa = Math.ceil(areaAdquiridaGlobal / 3);
  const valorArgamassa = sacosArgamassa * precoArgamassa;

  const totalKgRejunte = areaAdquiridaGlobal / 5;
  const arredondadoKg = totalKgRejunte % 1 >= 0.5 ? Math.ceil(totalKgRejunte) : Math.floor(totalKgRejunte);
  const sacos5kg = Math.floor(arredondadoKg / 5);
  const restanteKg = arredondadoKg - (sacos5kg * 5);
  const sacos1kg = restanteKg;

  let valorRejunte = tipo === "ceramica"
    ? (sacos5kg * 59.90) + (sacos1kg * 14.90)
    : (sacos5kg * 91.90) + (sacos1kg * 23.90);

  const total = valorPiso + valorArgamassa + valorRejunte;

  let parcelas = "";
  if (total >= 400) {
    for (let i = 1; i <= 10; i++) {
      let vp = (total / i).toFixed(2);
      parcelas += `${i}x de R$ ${vp}\n`;
    }
  } else {
    const minParcela = 40;
    const nParcelas = Math.floor(total / minParcela) || 1;
    for (let i = 1; i <= nParcelas; i++) {
      let vp = (total / i).toFixed(2);
      parcelas += `${i}x de R$ ${vp}\n`;
    }
  }

  document.getElementById("resultadoFinal").innerText = `
Argamassa:
- √Årea base: ${areaAdquiridaGlobal.toFixed(2)} m¬≤
- C√°lculo: ${areaAdquiridaGlobal.toFixed(2)} √∑ 3 = ${sacosArgamassa} sacos
- Valor: R$ ${valorArgamassa.toFixed(2)}

Rejunte (${tipo === 'ceramica' ? 'Cer√¢mica' : 'Porcelanato'}):
- Estimado: ${totalKgRejunte.toFixed(1)} kg ‚Üí Arredondado: ${arredondadoKg} kg
- Sacos de 5kg: ${sacos5kg}
- Sacos de 1kg: ${sacos1kg}
- Valor: R$ ${valorRejunte.toFixed(2)}

Total geral: R$ ${total.toFixed(2)}

Parcelamento:
${parcelas}`.trim();

  salvarDados();
}function gerarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const cliente = document.getElementById("idProduto").value || "N√£o informado";
  const resultadoFinal = document.getElementById("resultadoFinal").innerText;
  const area = areaAdquiridaGlobal.toFixed(2) + " m¬≤";

  const qtdArgamassa = resultadoFinal.match(/= (\d+) sacos/)?.[1] || "-";
  const valorArgamassa = resultadoFinal.match(/Valor: R\$ ([\d.,]+)/)?.[1] || "-";
  const sacos5kg = resultadoFinal.match(/Sacos de 5kg: (\d+)/)?.[1] || "0";
  const sacos1kg = resultadoFinal.match(/Sacos de 1kg: (\d+)/)?.[1] || "0";
  const valorPiso = document.getElementById("resultadoCeramica").innerText.match(/Valor da cer√¢mica:\s*R\$ ([\d.,]+)/)?.[1] || "-";
  const parcelas = resultadoFinal.split("Parcelamento:")[1]?.trim() || "Sem op√ß√µes.";

  doc.setFont("helvetica", "bold");
  doc.setFontSize(14);
  doc.text("Or√ßamento de Piso ‚Äì m2A", 20, 20);

  doc.setFont("helvetica", "normal");
  doc.setFontSize(12);
  let y = 35;

  const linhas = [
    `ID / Cliente: ${cliente}`,
    `√Årea Real Adquirida: ${area}`,
    `Valor da Cer√¢mica: R$ ${valorPiso}`,
    `Argamassa:`,
    `- Quantidade: ${qtdArgamassa} sacos`,
    `- Valor: R$ ${valorArgamassa}`,
    `Rejunte:`,
    `- 5kg: ${sacos5kg} sacos`,
    `- 1kg: ${sacos1kg} sacos`,
    `Parcelamento:`
  ];

  linhas.forEach((linha, index) => {
    doc.text(linha, 20, y + index * 10);
  });

  parcelas.split("\n").forEach((parc, i) => {
    doc.text(parc, 28, y + (linhas.length + i) * 10);
  });

  doc.save("orcamento-piso-detalhado.pdf");
}

function compararMarcas() {
  const valorMetro = parseFloat(document.getElementById("valorMetro").value) || 35;
  const area = areaAdquiridaGlobal || 50;

  const marcas = [
    { nome: "Tupan", precoPiso: 33.90, precoArgamassa: 36.00 },
    { nome: "Ferreira Costa", precoPiso: 37.90, precoArgamassa: 39.90 },
    { nome: "Cazanova", precoPiso: 31.99, precoArgamassa: 34.90 }
  ];

  let html = "<strong>Comparativo de Marcas na regi√£o:</strong><br><br>";

  marcas.forEach(marca => {
    const piso = area * marca.precoPiso;
    const argamassa = Math.ceil(area / 3) * marca.precoArgamassa;
    const rejunte = area < 100 ? 250 : 300;
    const total = piso + argamassa + rejunte;

    html += `
<u>${marca.nome}</u><br>
- Piso: R$ ${piso.toFixed(2)}<br>
- Argamassa: R$ ${argamassa.toFixed(2)}<br>
- Rejunte (estimado): R$ ${rejunte.toFixed(2)}<br>
- <strong>Total estimado: R$ ${total.toFixed(2)}</strong><br><br>
    `;
  });

  document.getElementById("resultadoComparativo").innerHTML = html;
  salvarDados();
}

function limparTudo() {
  document.querySelectorAll("input").forEach(inp => inp.value = "");
  document.getElementById("resultadoCeramica").innerHTML = "";
  document.getElementById("resultadoFinal").innerHTML = "";
  document.getElementById("resultadoComparativo").innerHTML = "";
  areaAdquiridaGlobal = 0;
  areaComSobraGlobal = 0;
  localStorage.removeItem("orcamentoM2A");
}

document.querySelectorAll("input, select").forEach(el => {
  el.addEventListener("input", salvarDados);
});

function salvarDados() {
  const dados = {
    tipoPiso: document.getElementById("tipoPiso").value,
    idProduto: document.getElementById("idProduto").value,
    areaTotal: document.getElementById("areaTotal").value,
    areaCaixa: document.getElementById("areaCaixa").value,
    valorMetro: document.getElementById("valorMetro").value,
    margemSobra: document.getElementById("margemSobra").value,
    argamassaOutro: document.getElementById("argamassaOutro").value,
    resultadoCeramica: document.getElementById("resultadoCeramica").innerHTML,
    resultadoFinal: document.getElementById("resultadoFinal").innerText,
    resultadoComparativo: document.getElementById("resultadoComparativo").innerHTML
  };
  localStorage.setItem("orcamentoM2A", JSON.stringify(dados));
}

window.addEventListener("DOMContentLoaded", () => {
  const escuro = localStorage.getItem("temaEscuro") === "1";
  document.body.classList.toggle("dark-mode", escuro);
  document.getElementById("toggleTema").checked = escuro;

  const salvo = localStorage.getItem("orcamentoM2A");
  if (salvo) {
    const dados = JSON.parse(salvo);
    document.getElementById("tipoPiso").value = dados.tipoPiso || "ceramica";
    document.getElementById("idProduto").value = dados.idProduto || "";
    document.getElementById("areaTotal").value = dados.areaTotal || "";
    document.getElementById("areaCaixa").value = dados.areaCaixa || "";
    document.getElementById("valorMetro").value = dados.valorMetro || "";
    document.getElementById("margemSobra").value = dados.margemSobra || "10";
    document.getElementById("argamassaOutro").value = dados.argamassaOutro || "";
    document.getElementById("resultadoCeramica").innerHTML = dados.resultadoCeramica || "";
    document.getElementById("resultadoFinal").innerText = dados.resultadoFinal || "";
    document.getElementById("resultadoComparativo").innerHTML = dados.resultadoComparativo || "";
  }
});

document.getElementById('toggleTema').addEventListener('change', function () {
  document.body.classList.toggle('dark-mode', this.checked);
  localStorage.setItem('temaEscuro', this.checked ? '1' : '0');
});
